<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="pageTitle">Premium Power LLC | Power You Can Trust</title>
    <meta name="description" content="Premium diesel generators, installation, and maintenance in Egypt. Authorized Perkins, Volvo, and Doosan suppliers.">
    
    <!-- Performance & SEO Meta -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https:">
    <meta name="theme-color" content="#003087">
    <link rel="preconnect" href="https://cdn.tailwindcss.com">
    <link rel="preconnect" href="https://unpkg.com">
    
    <!-- Critical CSS Inlined -->
    <style>
        :root {
            --primary-dark: #003087;
            --primary-light: #0070BA;
            --accent: #009cde;
            --fuel-amber: #f59e0b;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
        }

        /* Critical above-the-fold styles */
        .navbar-initial { background: transparent; }
        .hero-section { background: linear-gradient(to bottom right, #002870, var(--primary-dark), var(--primary-light)); }
        
        /* Glassmorphism Utilities */
        .glass-dark, .glass-card { backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); }
        .glass-dark { background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.1); }
        .glass-card { background: rgba(255, 255, 255, 0.7); border: 1px solid rgba(255, 255, 255, 0.5); }
        
        /* Animation Utilities */
        @keyframes slideUpFade {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        @keyframes pulseSlow {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 0.2; }
        }
        .animate-slide-up { animation: slideUpFade 0.6s ease-out; }
        .animate-pulse-slow { animation: pulseSlow 4s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
    </style>

    <!-- Non-critical CSS loaded async -->
    <link rel="preload" href="https://cdn.tailwindcss.com" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://cdn.tailwindcss.com"></noscript>
    
    <script>
        // Minimal Tailwind config
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        paypal: { dark: '#003087', light: '#0070BA', accent: '#009cde' },
                        fuel: { main: '#f59e0b' }
                    }
                }
            }
        }
    </script>
</head>
<body class="font-sans text-gray-800 bg-gray-50" dir="ltr">

<!-- Navigation -->
<nav id="navbar" class="fixed w-full z-40 transition-all duration-300 py-6 navbar-initial">
    <!-- Navigation content remains same but optimized -->
    <div class="max-w-7xl mx-auto px-6 flex justify-between items-center">
        <a href="#home" class="flex items-center gap-2 group">
            <div id="logo-bg" class="w-10 h-10 rounded-full flex items-center justify-center bg-white shadow-lg transition-colors">
                <span id="logo-text" class="font-bold text-xl italic pr-1 text-paypal-dark">P</span>
            </div>
            <div class="flex flex-col leading-none">
                <span id="brand-1" class="font-bold text-lg tracking-tight text-white">Premium</span>
                <span id="brand-2" class="font-bold text-lg tracking-tight text-blue-200">Power</span>
            </div>
        </a>
        <!-- Rest of nav... -->
    </div>
</nav>

<!-- Hero Section -->
<section id="home" class="relative min-h-screen flex items-center pt-20 overflow-hidden hero-section">
    <!-- Hero content... -->
</section>

<!-- Calculator Section -->
<section id="calculator" class="py-24 bg-white relative overflow-hidden">
    <!-- Calculator content... -->
</section>

<!-- Rest of sections... -->

<!-- Lazy loaded non-critical CSS -->
<style>
    /* Non-critical styles */
    .font-arabic { font-family: Tahoma, 'Noto Sans Arabic', sans-serif; }
    .comparison-cell { padding: 1.25rem 1rem; border-bottom: 1px solid #e5e7eb; transition: background-color 0.3s ease; }
    .comparison-header { font-weight: 800; color: #003087; background-color: #f3f4f6; text-transform: uppercase; }
    .premium-column { background-color: #e0f2fe; color: #003087; font-weight: 700; }
    
    /* Chat and spec animations */
    #chat-menu { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); transform-origin: bottom right; }
    .chat-open { opacity: 1 !important; transform: scale(1) translateY(0) !important; pointer-events: auto !important; }
    .spec-content { max-height: 0; overflow: hidden; transition: max-height 0.4s ease-in-out; }
    .spec-open { max-height: 300px; }
</style>

<!-- Optimized JavaScript -->
<script>
// DOM Cache for performance
class DOMCache {
    constructor() {
        this.elements = new Map();
    }
    
    get(id) {
        if (!this.elements.has(id)) {
            this.elements.set(id, document.getElementById(id));
        }
        return this.elements.get(id);
    }
    
    query(selector) {
        const key = `query-${selector}`;
        if (!this.elements.has(key)) {
            this.elements.set(key, document.querySelector(selector));
        }
        return this.elements.get(key);
    }
    
    queryAll(selector) {
        const key = `queryAll-${selector}`;
        if (!this.elements.has(key)) {
            this.elements.set(key, document.querySelectorAll(selector));
        }
        return this.elements.get(key);
    }
}

const $ = new DOMCache();

// Debounce utility
function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

// Main Application Class
class PremiumPowerApp {
    constructor() {
        this.currentLang = 'en';
        this.calculationCache = new Map();
        this.init();
    }

    init() {
        this.setupEventListeners();
        this.loadTranslations();
        this.initializeModules();
    }

    setupEventListeners() {
        // Event delegation for better performance
        document.addEventListener('click', (e) => {
            this.handleClickEvents(e);
        });

        // Debounced scroll events
        window.addEventListener('scroll', debounce(() => {
            this.handleScroll();
        }, 10));

        // Optimized input events
        document.addEventListener('input', debounce((e) => {
            if (e.target.matches('[data-calc-input]')) {
                this.calculator.calculateKVA();
            }
        }, 150));
    }

    handleClickEvents(e) {
        const target = e.target.closest('[data-action]') || e.target;
        const action = target.dataset.action;

        switch (action) {
            case 'toggle-chat':
                this.chat.toggleMenu();
                break;
            case 'switch-language':
                this.translator.switchLanguage(target.dataset.lang);
                break;
            case 'toggle-spec':
                this.ui.toggleSpec(target.dataset.spec);
                break;
            case 'set-sound-mode':
                this.ui.setSoundMode(target.dataset.mode);
                break;
            case 'fill-quote':
                this.forms.fillQuoteRequest();
                break;
            case 'download-spec':
                this.ui.showMessage(this.translator.get('downloadStarting'));
                break;
        }

        // Handle navigation links
        if (target.matches('a[href^="#"]')) {
            e.preventDefault();
            this.smoothScroll(target.getAttribute('href'));
        }
    }

    smoothScroll(target) {
        const element = document.querySelector(target);
        if (element) {
            element.scrollIntoView({ behavior: 'smooth' });
        }
    }

    handleScroll() {
        this.ui.updateNavbar();
    }

    initializeModules() {
        this.calculator = new Calculator();
        this.translator = new Translator();
        this.ui = new UIComponents();
        this.chat = new ChatModule();
        this.forms = new FormHandler();
        
        // Lazy load non-critical modules
        this.lazyLoadModules();
    }

    lazyLoadModules() {
        // Load these when user interacts with related sections
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    switch(entry.target.id) {
                        case 'projects-gallery':
                            this.loadGalleryModule();
                            break;
                        case 'comparison':
                            this.loadComparisonModule();
                            break;
                    }
                    observer.unobserve(entry.target);
                }
            });
        });

        ['projects-gallery', 'comparison'].forEach(id => {
            const element = $.get(id);
            if (element) observer.observe(element);
        });
    }

    async loadGalleryModule() {
        // Simulate lazy loading
        console.log('Loading gallery module...');
    }

    async loadComparisonModule() {
        console.log('Loading comparison module...');
    }
}

// Calculator Module
class Calculator {
    constructor() {
        this.cache = new Map();
        this.WATT_VALUES = {
            ac1: 1200, ac3: 2400, pump: 750, pc: 200, light: 100
        };
    }

    calculateKVA() {
        const inputs = this.getInputValues();
        const cacheKey = JSON.stringify(inputs);
        
        if (this.cache.has(cacheKey)) {
            this.displayResults(this.cache.get(cacheKey));
            return;
        }

        const result = this.performCalculation(inputs);
        this.cache.set(cacheKey, result);
        this.displayResults(result);
    }

    getInputValues() {
        return {
            ac1: parseInt($.get('calc-ac1')?.value) || 0,
            ac3: parseInt($.get('calc-ac3')?.value) || 0,
            pump: parseInt($.get('calc-pump')?.value) || 0,
            pc: parseInt($.get('calc-pc')?.value) || 0,
            light: parseInt($.get('calc-light')?.value) || 0
        };
    }

    performCalculation(inputs) {
        let totalWatts = 0;
        Object.entries(inputs).forEach(([key, value]) => {
            totalWatts += value * this.WATT_VALUES[key];
        });

        const totalKW = totalWatts / 1000;
        const requiredKVA = totalKW / 0.8;
        const finalKVA = Math.ceil(requiredKVA * 1.25);
        
        return {
            kva: finalKVA > 0 ? finalKVA : 0,
            fuel: Math.ceil(finalKVA * 0.21)
        };
    }

    displayResults(result) {
        $.get('result-kva').textContent = result.kva;
        $.get('result-fuel').textContent = result.fuel;
    }
}

// Translation System
class Translator {
    constructor() {
        this.translations = new Map();
        this.currentLang = 'en';
    }

    async loadTranslations() {
        // In a real app, load from external JSON
        this.translations.set('en', this.getEnglishTranslations());
        this.translations.set('ar', this.getArabicTranslations());
    }

    switchLanguage(lang) {
        this.currentLang = lang;
        this.updatePageDirection(lang);
        this.updateContent(lang);
    }

    updatePageDirection(lang) {
        document.documentElement.lang = lang;
        document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
        document.body.classList.toggle('font-arabic', lang === 'ar');
    }

    updateContent(lang) {
        const strings = this.translations.get(lang);
        if (!strings) return;

        // Batch DOM updates
        requestAnimationFrame(() => {
            this.updateTextElements(strings);
            this.updatePlaceholders(strings);
            this.reinitializeComponents();
        });
    }

    updateTextElements(strings) {
        Object.entries(strings).forEach(([key, value]) => {
            const elements = document.querySelectorAll(`[data-i18n="${key}"]`);
            elements.forEach(el => {
                el.textContent = value;
            });
        });
    }

    updatePlaceholders(strings) {
        Object.entries(strings).forEach(([key, value]) => {
            const elements = document.querySelectorAll(`[data-i18n-placeholder="${key}"]`);
            elements.forEach(el => {
                el.placeholder = value;
            });
        });
    }

    reinitializeComponents() {
        // Re-run any component that needs language-specific setup
        lucide.createIcons();
    }

    get(key) {
        const strings = this.translations.get(this.currentLang);
        return strings?.[key] || key;
    }

    getEnglishTranslations() {
        return {
            pageTitle: "Premium Power LLC | Power You Can Trust",
            chatSales: "Sales Inquiry",
            // ... all other English translations
        };
    }

    getArabicTranslations() {
        return {
            pageTitle: "بريميوم باور | طاقة يمكنك الاعتماد عليها",
            chatSales: "المبيعات",
            // ... all other Arabic translations
        };
    }
}

// UI Components Manager
class UIComponents {
    constructor() {
        this.scrollThreshold = 20;
    }

    updateNavbar() {
        const nav = $.get('navbar');
        const scrolled = window.scrollY > this.scrollThreshold;
        
        nav.classList.toggle('bg-white/95', scrolled);
        nav.classList.toggle('backdrop-blur-md', scrolled);
        nav.classList.toggle('shadow-lg', scrolled);
        nav.classList.toggle('py-3', scrolled);
        nav.classList.toggle('py-6', !scrolled);

        this.updateNavbarColors(scrolled);
    }

    updateNavbarColors(scrolled) {
        const selectors = {
            '#logo-bg': [['bg-white', 'bg-paypal-light'], scrolled],
            '#logo-text': [['text-paypal-dark', 'text-white'], scrolled],
            '#brand-1': [['text-white', 'text-paypal-dark'], scrolled],
            '#brand-2': [['text-blue-200', 'text-paypal-light'], scrolled],
            '.nav-link': [['text-white/90', 'text-gray-600'], scrolled],
            '#nav-btn': [['border-white/30', 'bg-paypal-light'], scrolled]
        };

        Object.entries(selectors).forEach(([selector, [classes, condition]]) => {
            const [classA, classB] = classes;
            const elements = document.querySelectorAll(selector);
            elements.forEach(el => {
                el.classList.toggle(classA, !condition);
                el.classList.toggle(classB, condition);
            });
        });
    }

    toggleSpec(specId) {
        const element = $.get(specId);
        const icon = $.get(`icon-${specId}`);
        
        if (!element || !icon) return;

        const isOpening = !element.classList.contains('spec-open');
        
        // Close all specs first
        document.querySelectorAll('.spec-content').forEach(el => {
            el.classList.remove('spec-open');
        });
        document.querySelectorAll('[id^="icon-spec-"]').forEach(el => {
            el.style.transform = 'rotate(0deg)';
        });

        if (isOpening) {
            element.classList.add('spec-open');
            icon.style.transform = 'rotate(180deg)';
        }
    }

    setSoundMode(mode) {
        const bar = $.get('sound-bar');
        const val = $.get('sound-val');
        const desc = $.get('sound-desc');
        
        if (mode === 'open') {
            this.updateSoundDisplay(bar, val, desc, '85%', '85 db', 'bg-red-500', 'soundTraffic');
        } else {
            this.updateSoundDisplay(bar, val, desc, '65%', '65 db', 'bg-green-500', 'soundOffice');
        }
        
        this.updateSoundButtons(mode);
    }

    updateSoundDisplay(bar, val, desc, width, value, colorClass, textKey) {
        bar.style.width = width;
        bar.className = `absolute left-0 h-full ${colorClass} transition-all duration-700 ease-out opacity-80`;
        val.textContent = value;
        desc.textContent = app.translator.get(textKey);
    }

    updateSoundButtons(mode) {
        const buttons = {
            'btn-sound-open': mode === 'open',
            'btn-sound-silent': mode === 'silent'
        };

        Object.entries(buttons).forEach(([id, isActive]) => {
            const btn = $.get(id);
            if (!btn) return;

            if (isActive) {
                btn.classList.add('bg-paypal-light', 'text-white', 'border-paypal-light');
                btn.classList.remove('text-gray-500', 'border-gray-200');
            } else {
                btn.classList.remove('bg-paypal-light', 'text-white', 'border-paypal-light');
                btn.classList.add('text-gray-500', 'border-gray-200');
            }
        });
    }

    showMessage(message) {
        const box = $.get('message-box');
        const content = $.get('message-box-content');
        
        if (!box || !content) return;

        content.textContent = message;
        box.classList.remove('hidden');
        
        requestAnimationFrame(() => {
            box.classList.add('opacity-100');
            box.querySelector('div').classList.remove('scale-95');
        });
    }

    hideMessage() {
        const box = $.get('message-box');
        if (!box) return;

        box.classList.add('opacity-100');
        box.querySelector('div').classList.add('scale-95');
        
        setTimeout(() => {
            box.classList.add('hidden');
        }, 300);
    }
}

// Chat Module
class ChatModule {
    toggleMenu() {
        const menu = $.get('chat-menu');
        menu?.classList.toggle('chat-open');
    }
}

// Form Handler
class FormHandler {
    fillQuoteRequest() {
        const kva = $.get('result-kva')?.textContent || '0';
        const msgField = $.get('contact-message');
        
        if (!msgField) return;

        const text = app.currentLang === 'ar' 
            ? `مرحباً، بناءً على حساب الأحمال على الموقع، أنا مهتم بمولد بقدرة تقريبية ${kva} ك.ف.أ. يرجى التواصل معي للتفاصيل.`
            : `Hello, based on the load calculator on your website, I am interested in a generator with approximately ${kva} KVA capacity. Please contact me with details.`;

        msgField.value = text;
        app.smoothScroll('#contact');
    }

    handleFormSubmit(e) {
        e.preventDefault();
        app.ui.showMessage(app.translator.get('formSubmitted'));
        e.target.reset();
    }
}

// FAQ System
class FAQSystem {
    constructor() {
        this.faqs = [
            {
                q_en: "How long does delivery and installation take?",
                a_en: "Standard delivery and installation is completed within 7–15 working days...",
                q_ar: "كم تستغرق عملية التوصيل والتركيب؟",
                a_ar: "يتراوح وقت التسليم والتركيب القياسي من 7 إلى 15 يوم عمل..."
            }
            // ... more FAQs
        ];
    }

    render(lang) {
        const container = $.get('faq-container');
        if (!container) return;

        container.innerHTML = this.faqs.map(faq => `
            <div class="border-b border-gray-100 last:border-b-0">
                <button class="w-full flex justify-between items-center font-bold text-lg text-paypal-dark py-4 hover:text-paypal-light transition-colors" 
                        onclick="this.nextElementSibling.classList.toggle('hidden'); this.querySelector('svg').classList.toggle('rotate-180')" 
                        dir="${lang === 'ar' ? 'rtl' : 'ltr'}">
                    ${lang === 'ar' ? faq.q_ar : faq.q_en} 
                    <i data-lucide="chevron-down" class="w-6 h-6 text-paypal-light transition-transform duration-300 transform"></i>
                </button>
                <p class="hidden text-gray-600 pb-4 leading-relaxed" dir="${lang === 'ar' ? 'rtl' : 'ltr'}">
                    ${lang === 'ar' ? faq.a_ar : faq.a_en}
                </p>
            </div>
        `).join('');

        lucide.createIcons();
    }
}

// Live Monitoring System
class LiveMonitoring {
    constructor() {
        this.interval = null;
    }

    start() {
        this.update();
        this.interval = setInterval(() => this.update(), 3000);
    }

    stop() {
        if (this.interval) {
            clearInterval(this.interval);
        }
    }

    update() {
        const baseKVA = parseInt($.get('result-kva')?.textContent) || 50;
        const liveKVA = Math.floor(baseKVA * (0.3 + Math.random() * 0.7));
        const liveFuel = Math.floor(liveKVA * 0.21);
        const liveRuntime = Math.floor(Math.random() * 10000);
        
        this.updateElement('live-kva', liveKVA + ' KVA');
        this.updateElement('live-fuel', liveFuel + ' L/h');
        this.updateElement('live-runtime', liveRuntime + ' hrs');
    }

    updateElement(id, value) {
        const element = $.get(id);
        if (element) element.textContent = value;
    }
}

// Initialize application when DOM is ready
document.addEventListener('DOMContentLoaded', () => {
    window.app = new PremiumPowerApp();
});

// Load Lucide icons (non-critical)
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
        const script = document.createElement('script');
        script.src = 'https://unpkg.com/lucide@latest';
        script.onload = () => lucide.createIcons();
        document.head.appendChild(script);
    });
} else {
    const script = document.createElement('script');
    script.src = 'https://unpkg.com/lucide@latest';
    script.onload = () => lucide.createIcons();
    document.head.appendChild(script);
}
</script>

</body>
</html>